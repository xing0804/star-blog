---
title: Vue diff算法原理
date: 2023-04-09
categories:
 - Vue
tags:
 - vue
---

## Diff算法
> diff算法就是将虚拟节点进行对比,并返回一个patch对象来存储两个节点不同的地方,最后用返回的这个patch对象记录的消息去局部更新Dom
### 特点
* 只会同层级进行比较,不会跨层级比较
* 在比较过程中,循环从两边向中间比较
* 边比较边更新
### diff算法步骤
* 先用js对象结构标识DOM树的结构,然后用这个树解析构建一个真正的DOM树,插到文档当中
* 在数据进行变更的时候,构建一个新的对象树,然后用新的树和旧的树进行不叫(diff),记录两个树的差异
* 把新树记录的差异应用到旧树所构建的真正DOM树上(patch),更新视图

### key的作用
* 为了高效的更新虛拟DOM，其原理是vue在patch（补丁）过程中通过key可以精准判断两个节点是否是同一个，从而避免频繁更新不同元素，使得整个patch过程更加高效，减少DOM操作量，提高性能。
* 若不设置key还可能在列表更新时引发一些隐蔽的bug.eg:某行不该更新的却更新了
* vue中在使用相同标签名元素的过渡切换时，也会使用到key属性，其目的也是为了让vue可以区分它们，否则vue只会替换其内部属性而不会触发过渡效果。